<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Curatore</title>
    <style>
        .hidden { display: none; }
        table {
            border-collapse: collapse;
            margin-top: 20px;
            width: 100%;
            max-width: 1000px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th { background: #f2f2f2; }
        button {
            margin: 4px;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        .commento-input { width: 100%; min-width: 150px; }
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: 8px;
            text-align: center; max-width: 400px;
        }
        .modal-content button { margin-top: 15px; padding: 8px 16px; }
    </style>
</head>
<body>
<h1 th:text="'Benvenuto ' + ${utente != null ? utente.nome : 'Utente'} + ', il tuo ruolo è ' + (${utente != null ? utente.ruolo : 'Curatore'}) + '.'">
    Benvenuto, il tuo ruolo è Curatore.
</h1>

<h2>Dashboard Curatore</h2>

<!-- ====== PRODOTTI ====== -->
<h3>Prodotti in attesa di approvazione</h3>
<table>
    <thead>
    <tr>
        <th>Nome</th><th>Creatore</th><th>Descrizione</th><th>Quantità</th><th>Prezzo</th><th>Indirizzo</th>
        <th>Certificati</th><th>Foto</th><th>Accetta</th><th>Rifiuta</th><th>Commento</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="prodotto : ${prodotti}">
        <td th:text="${prodotto.nome}">Nome</td>
        <td th:text="${prodotto.creatoDa}">Creatore</td>
        <td th:text="${prodotto.descrizione}">Descrizione</td>
        <td th:text="${prodotto.quantita}">0</td>
        <td th:text="${prodotto.prezzo}">0.00</td>
        <td th:text="${prodotto.indirizzo}">Indirizzo</td>
        <td>
            <ul>
                <li th:each="cert : ${prodotto.certificati}">
                    <a th:href="@{'/file/certificati/' + ${cert}}" target="_blank" th:text="${cert}"></a>
                </li>
            </ul>
        </td>
        <td>
            <ul>
                <li th:each="foto : ${prodotto.foto}">
                    <a th:href="@{'/file/foto/' + ${foto}}" target="_blank" th:text="${foto}"></a>
                </li>
            </ul>
        </td>
        <td>
            <form th:action="@{/curatore/approvaProdotto}" method="post">
                <input type="hidden" name="nome" th:value="${prodotto.nome}"/>
                <input type="hidden" name="creatore" th:value="${prodotto.creatoDa}"/>
                <button type="button" class="approve-btn" th:attr="data-nome=${prodotto.nome}">Accetta</button>
            </form>
        </td>
        <td>
            <form th:action="@{/curatore/rifiutaProdotto}" method="post" th:id="'form-rifiuta-prod-' + ${prodotto.nome} + '-' + ${prodotto.creatoDa}">
                <input type="hidden" name="nome" th:value="${prodotto.nome}"/>
                <input type="hidden" name="creatore" th:value="${prodotto.creatoDa}"/>
                <button type="button" class="reject-btn" th:attr="data-nome=${prodotto.nome}">Rifiuta</button>
            </form>
        </td>
        <td>
            <input type="text" name="commento" class="commento-input"
                   placeholder="Inserisci commento"
                   th:form="'form-rifiuta-prod-' + ${prodotto.nome} + '-' + ${prodotto.creatoDa}"/>
        </td>
    </tr>
    </tbody>
</table>

<!-- ====== PACCHETTI ====== -->
<h3>Pacchetti in attesa di approvazione</h3>
<table>
    <thead>
    <tr>
        <th>Nome</th><th>Creatore</th><th>Descrizione</th><th>Quantità</th><th>Prezzo Totale</th><th>Indirizzo</th>
        <th>Certificati</th><th>Foto</th><th>Prodotti Inclusi</th>
        <th>Accetta</th><th>Rifiuta</th><th>Commento</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="pacchetto : ${pacchetti}">
        <td th:text="${pacchetto.nome}">Nome</td>
        <td th:text="${pacchetto.creatoDa}">Creatore</td>
        <td th:text="${pacchetto.descrizione}">Descrizione</td>
        <td th:text="${pacchetto.quantita}">0</td>
        <td th:text="${pacchetto.prezzo}">0.00</td>
        <td th:text="${pacchetto.indirizzo}">Indirizzo</td>
        <td>
            <ul>
                <li th:each="cert : ${pacchetto.certificati}">
                    <a th:href="@{'/file/certificati/' + ${cert}}" target="_blank" th:text="${cert}"></a>
                </li>
            </ul>
        </td>
        <td>
            <ul>
                <li th:each="foto : ${pacchetto.foto}">
                    <a th:href="@{'/file/foto/' + ${foto}}" target="_blank" th:text="${foto}"></a>
                </li>
            </ul>
        </td>
        <td>
            <ul>
                <li th:each="p : ${pacchetto.prodotti}" th:text="${p}"></li>
            </ul>
        </td>
        <td>
            <form th:action="@{/curatore/approvaPacchetto}" method="post">
                <input type="hidden" name="nome" th:value="${pacchetto.nome}"/>
                <input type="hidden" name="creatore" th:value="${pacchetto.creatoDa}"/>
                <button type="button" class="approve-btn" th:attr="data-nome=${pacchetto.nome}">Accetta</button>
            </form>
        </td>
        <td>
            <form th:action="@{/curatore/rifiutaPacchetto}" method="post" th:id="'form-rifiuta-pac-' + ${pacchetto.nome} + '-' + ${pacchetto.creatoDa}">
                <input type="hidden" name="nome" th:value="${pacchetto.nome}"/>
                <input type="hidden" name="creatore" th:value="${pacchetto.creatoDa}"/>
                <button type="button" class="reject-btn" th:attr="data-nome=${pacchetto.nome}">Rifiuta</button>
            </form>
        </td>
        <td>
            <input type="text" name="commento" class="commento-input"
                   placeholder="Inserisci commento"
                   th:form="'form-rifiuta-pac-' + ${pacchetto.nome} + '-' + ${pacchetto.creatoDa}"/>
        </td>
    </tr>
    </tbody>
</table>

<!-- Modali -->
<div id="approveModal" class="modal">
    <div class="modal-content">
        <p id="approveMessage"></p>
        <button onclick="closeApproveModal()">OK</button>
    </div>
</div>
<div id="rejectModal" class="modal">
    <div class="modal-content">
        <p id="rejectMessage"></p>
        <button onclick="closeRejectModal()">OK</button>
    </div>
</div>

<p><a th:href="@{/}">Torna alla Home</a></p>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".approve-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                const nome = this.getAttribute("data-nome");
                document.getElementById("approveMessage").textContent = nome + " approvato!";
                document.getElementById("approveModal").style.display = "flex";
                window.formToSubmit = this.closest("form");
            });
        });
        document.querySelectorAll(".reject-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                const nome = this.getAttribute("data-nome");
                document.getElementById("rejectMessage").textContent = nome + " rifiutato!";
                document.getElementById("rejectModal").style.display = "flex";
                window.formToSubmit = this.closest("form");
            });
        });
    });
    function closeApproveModal() {
        document.getElementById("approveModal").style.display = "none";
        if (window.formToSubmit) { window.formToSubmit.submit(); window.formToSubmit = null; }
    }
    function closeRejectModal() {
        document.getElementById("rejectModal").style.display = "none";
        if (window.formToSubmit) { window.formToSubmit.submit(); window.formToSubmit = null; }
    }
</script>
</body>
</html>

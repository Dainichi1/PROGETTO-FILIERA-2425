<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Curatore</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">

    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <style>
        table {
            border-collapse: collapse;
            margin-top: 20px;
            width: 100%;
            max-width: 1000px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th { background: #f2f2f2; }
        button {
            margin: 4px;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        .commento-input { width: 100%; min-width: 150px; }

        /* Modali */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            min-width: 300px;
            text-align: center;
        }
    </style>
</head>
<body>
<h1 th:text="'Benvenuto ' + (${utente?.nome ?: 'Utente'}) + ', il tuo ruolo √® ' + (${utente?.ruolo ?: 'Curatore'}) + '.'">
    Benvenuto, il tuo ruolo √® Curatore.
</h1>

<h2>Dashboard Curatore</h2>

<!-- bottone eliminazione profilo -->
<button id="btnDeleteProfile" class="btn btn-danger btn-lg">
    üóëÔ∏è Elimina profilo
</button>

<!-- ====== PRODOTTI ====== -->
<h3>Prodotti in attesa di approvazione</h3>
<table>
    <thead>
    <tr>
        <th>Nome</th><th>Creatore</th><th>Descrizione</th><th>Quantit√†</th><th>Prezzo</th><th>Indirizzo</th>
        <th>Certificati</th><th>Foto</th><th>Accetta</th><th>Rifiuta</th><th>Commento</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="prodotto : ${prodotti}">
        <td th:text="${prodotto.nome}">Nome</td>
        <td th:text="${prodotto.creatoDa}">Creatore</td>
        <td th:text="${prodotto.descrizione}">Descrizione</td>
        <td th:text="${prodotto.quantita}">0</td>
        <td th:text="${prodotto.prezzo}">0.00</td>
        <td th:text="${prodotto.indirizzo}">Indirizzo</td>
        <td>
            <ul>
                <li th:each="cert : ${prodotto.certificati}">
                    <a th:href="@{'/file/certificati/' + ${cert}}" target="_blank" th:text="${cert}"></a>
                </li>
            </ul>
        </td>
        <td>
            <ul>
                <li th:each="foto : ${prodotto.foto}">
                    <a th:href="@{'/file/foto/' + ${foto}}" target="_blank" th:text="${foto}"></a>
                </li>
            </ul>
        </td>
        <td>
            <form th:action="@{/curatore/approvaProdotto}" method="post">
                <input type="hidden" name="nome" th:value="${prodotto.nome}"/>
                <input type="hidden" name="creatore" th:value="${prodotto.creatoDa}"/>
                <button type="button" class="approve-btn" th:attr="data-nome=${prodotto.nome}">Accetta</button>
            </form>
        </td>
        <td>
            <form th:action="@{/curatore/rifiutaProdotto}" method="post"
                  th:id="'form-rifiuta-prod-' + ${prodotto.nome} + '-' + ${prodotto.creatoDa}">
                <input type="hidden" name="nome" th:value="${prodotto.nome}"/>
                <input type="hidden" name="creatore" th:value="${prodotto.creatoDa}"/>
                <button type="button" class="reject-btn" th:attr="data-nome=${prodotto.nome}">Rifiuta</button>
            </form>
        </td>
        <td>
            <input type="text" name="commento" class="commento-input"
                   placeholder="Inserisci commento"
                   th:form="'form-rifiuta-prod-' + ${prodotto.nome} + '-' + ${prodotto.creatoDa}"/>
        </td>
    </tr>
    </tbody>
</table>

<!-- ====== PACCHETTI ====== -->
<h3>Pacchetti in attesa di approvazione</h3>
<table>
    <thead>
    <tr>
        <th>Nome</th><th>Creatore</th><th>Descrizione</th><th>Prezzo</th><th>Indirizzo</th>
        <th>Accetta</th><th>Rifiuta</th><th>Commento</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="pacchetto : ${pacchetti}">
        <td th:text="${pacchetto.nome}">Nome</td>
        <td th:text="${pacchetto.creatoDa}">Creatore</td>
        <td th:text="${pacchetto.descrizione}">Descrizione</td>
        <td th:text="${pacchetto.prezzo}">0.00</td>
        <td th:text="${pacchetto.indirizzo}">Indirizzo</td>
        <td>
            <form th:action="@{/curatore/approvaPacchetto}" method="post">
                <input type="hidden" name="nome" th:value="${pacchetto.nome}"/>
                <input type="hidden" name="creatore" th:value="${pacchetto.creatoDa}"/>
                <button type="button" class="approve-btn" th:attr="data-nome=${pacchetto.nome}">Accetta</button>
            </form>
        </td>
        <td>
            <form th:action="@{/curatore/rifiutaPacchetto}" method="post"
                  th:id="'form-rifiuta-pac-' + ${pacchetto.nome} + '-' + ${pacchetto.creatoDa}">
                <input type="hidden" name="nome" th:value="${pacchetto.nome}"/>
                <input type="hidden" name="creatore" th:value="${pacchetto.creatoDa}"/>
                <button type="button" class="reject-btn" th:attr="data-nome=${pacchetto.nome}">Rifiuta</button>
            </form>
        </td>
        <td>
            <input type="text" name="commento" class="commento-input"
                   placeholder="Inserisci commento"
                   th:form="'form-rifiuta-pac-' + ${pacchetto.nome} + '-' + ${pacchetto.creatoDa}"/>
        </td>
    </tr>
    </tbody>
</table>


<!-- ====== TRASFORMATI ====== -->
<h3>Prodotti Trasformati in attesa di approvazione</h3>
<table>
    <thead>
    <tr>
        <th>Nome</th><th>Creatore</th><th>Descrizione</th><th>Indirizzo</th>
        <th>Accetta</th><th>Rifiuta</th><th>Commento</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="trasf : ${trasformati}">
        <td th:text="${trasf.nome}">Nome</td>
        <td th:text="${trasf.creatoDa}">Creatore</td>
        <td th:text="${trasf.descrizione}">Descrizione</td>
        <td th:text="${trasf.indirizzo}">Indirizzo</td>
        <td>
            <form th:action="@{/curatore/approvaTrasformato}" method="post">
                <input type="hidden" name="nome" th:value="${trasf.nome}"/>
                <input type="hidden" name="creatore" th:value="${trasf.creatoDa}"/>
                <button type="button" class="approve-btn" th:attr="data-nome=${trasf.nome}">Accetta</button>
            </form>
        </td>
        <td>
            <form th:action="@{/curatore/rifiutaTrasformato}" method="post"
                  th:id="'form-rifiuta-trasf-' + ${trasf.nome} + '-' + ${trasf.creatoDa}">
                <input type="hidden" name="nome" th:value="${trasf.nome}"/>
                <input type="hidden" name="creatore" th:value="${trasf.creatoDa}"/>
                <button type="button" class="reject-btn" th:attr="data-nome=${trasf.nome}">Rifiuta</button>
            </form>
        </td>
        <td>
            <input type="text" name="commento" class="commento-input"
                   placeholder="Inserisci commento"
                   th:form="'form-rifiuta-trasf-' + ${trasf.nome} + '-' + ${trasf.creatoDa}"/>
        </td>
    </tr>
    </tbody>
</table>


<!-- Modali conferma approvazione/rifiuto -->
<div id="approveModal" class="modal">
    <div class="modal-content">
        <p id="approveMessage"></p>
        <button onclick="closeApproveModal()">OK</button>
    </div>
</div>
<div id="rejectModal" class="modal">
    <div class="modal-content">
        <p id="rejectMessage"></p>
        <button onclick="closeRejectModal()">OK</button>
    </div>
</div>

<!-- Modale eliminazione profilo (fragment comune) -->
<div th:replace="fragments/profile-delete-modal :: profile-delete-modal"></div>
<div th:replace="fragments/profile-delete-notification :: profile-delete-notification"></div>

<p><a th:href="@{/}">‚¨Ö Torna alla Home</a></p>

<!-- Script gestione modali locali -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".approve-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                const nome = this.getAttribute("data-nome");
                document.getElementById("approveMessage").textContent = nome + " approvato!";
                document.getElementById("approveModal").style.display = "flex";
                window.formToSubmit = this.closest("form");
            });
        });
        document.querySelectorAll(".reject-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                const nome = this.getAttribute("data-nome");
                document.getElementById("rejectMessage").textContent = nome + " rifiutato!";
                document.getElementById("rejectModal").style.display = "flex";
                window.formToSubmit = this.closest("form");
            });
        });
    });
    function closeApproveModal() {
        document.getElementById("approveModal").style.display = "none";
        if (window.formToSubmit) { window.formToSubmit.submit(); window.formToSubmit = null; }
    }
    function closeRejectModal() {
        document.getElementById("rejectModal").style.display = "none";
        if (window.formToSubmit) { window.formToSubmit.submit(); window.formToSubmit = null; }
    }
</script>

<!-- Script curatore (gestione eliminazione profilo ecc.) -->
<script type="module" src="/js/pages/curatore.js"></script>

</body>
</html>
